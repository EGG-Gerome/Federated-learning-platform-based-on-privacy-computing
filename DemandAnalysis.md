---

## **面向数据流处理的隐私计算平台（基于联邦学习的组织细胞癌症识别平台）需求分析**

---

### **一、项目背景**
为提升医疗数据隐私保护下的癌症识别效率，本项目拟搭建一个基于联邦学习的分布式平台，允许多个医疗机构在不共享原始数据的前提下协作训练深度学习模型，用于组织细胞病理图像的癌症识别。平台需支持数据可视化,模型训练参数选择,联邦学习配置选择,训练过程可视化,模型参数评估。

---

### **二、用户角色与功能需求**

#### **1. 医疗机构用户（客户端）**
**功能需求**：
  - 数据上传：上传本地的组织细胞病理图像（支持PNG/JPG/DICOM格式）。
  - 配置文件修改:修改配置文件里面的配置
  - 任务参与：加入联邦学习任务，启动本地模型训练。
  - 训练监控：查看本地训练进度、损失曲线、资源占用（CPU/GPU）。
  - 结果下载：获取最终全局模型文件（.pt或.h5格式）。

#### **2. 计算平台使用者/研究人员（服务端前端[隐私计算的发起者]）**
**功能需求**：
  - 参数配置:可以配置联邦学习训练的策略
  - 联邦学习配置参数包括：基础训练配置（训练轮数(num_rounds，整数1-100，默认3）、本地训练周期(num_epochs，整数1-20，默认3）；客户端参与配置（客户端总数(num_clients，整数1-50，默认5)、最小可用客户端数(min_available_clients，整数1-num_clients，默认5)、训练参与比例(fraction_fit，滑动条0.1-1.0步长0.1，默认1.0)、评估参与比例(fraction_evaluate，滑动条0.1-1.0步长0.1，默认1.0)）；网络配置（服务器地址(server_address，IP:端口格式，默认"127.0.0.1:80")）。
  - 开始训练：页面可视化配置文件的参数,然后提供训练启动按钮。
  - 训练过程展示:可视化日志文件里面,训练轮次的结果准确率,精确率,召回率,F1绘制出对应的折线图和混淆矩阵
  - 模型评估：验证轮次的结果准确率,精确率,召回率,F1绘制出对应的折线图和混淆矩阵。

#### **3.(服务器后端）**
**功能需求**：
1. 任务管理

   - 创建任务：接收前端请求，生成唯一任务ID，调用Python服务端初始化模型，保存任务状态至内存。

   - 任务列表查询：返回所有任务的简略信息（ID、名称、状态）。

   - 任务详情查询：返回单个任务的详细进度、准确率、创建时间。

2. 传递联邦学习过程结果给前端

   - 进度更新：定期轮询Python服务端的日志，更新任务进度与准确率。
   
   - 传递结果：把 SUMMARY 传递（训练总轮次，总时间，总损失率，总准确率）



核心接口

接口	方法	说明
POST /tasks	POST	创建任务，返回成功信息。
GET /result	GET	获取所有任务详情（含进度、损失率、准确率）。


### **三、系统模块需求**

#### **1. 联邦学习核心模块**
- **客户端（Python）**：
  - 本地模型初始化：从服务端下载初始模型权重。
  - 隐私保护训练：基于本地数据训练模型，生成加密梯度参数。
  - 梯度上传：通过gRPC将梯度上传至服务端。
  - 日志输出：记录训练指标（损失、准确率）至结构化日志文件。

- **服务端（Python + FastAPI）**：
  - 任务调度：分配任务ID，协调多客户端训练节奏。
  - 梯度聚合：实现FedAvg/FedProx等算法，生成全局模型。
  - 模型分发：将更新后的模型推送至各客户端。
  - 异常处理：检测客户端掉线，触发重试机制。

#### **2. 业务后端（Java Spring Boot）**
- **核心功能**：
  - 日志收集：监听客户端日志文件，解析为JSON格式。
  - API网关：为前端提供RESTful接口，创建联邦学习任务。
  - 用户认证：JWT令牌签发与验证，角色权限拦截。（以后拓展）
  - 数据代理：接收前端上传的病理图像，转存至MinIO对象存储。（以后拓展）

- **关键接口**：
  ```text
  POST /api/tasks          # 创建联邦学习任务
  GET /api/result          # 获取最终结果
  ```

#### **3. 前端（Vue.js）**
- **核心页面**：
  - **仪表盘**：全局任务状态地图（显示参与机构位置）、资源占用监控。
  - **任务管理**：任务列表、进度条、实时日志滚动展示。
  - **数据看板**：模型准确率趋势图、混淆矩阵、ROC曲线。
  - **图像上传**：拖拽上传界面，支持批量上传与格式校验。
  - **报告生成**：导出PDF诊断报告（含模型置信度与医生备注）。

- **技术需求**：
  - 响应式布局：适配PC、平板及大屏显示器。
  - 可视化库：集成ECharts展示训练指标，D3.js渲染热力图。

---

### **四、非功能性需求**

#### **1. 性能需求**（当前阶段是多线程模拟，以后具体实现）
- 并发支持：至少50个客户端同时参与联邦学习任务。
- 响应时间：  
  - 前端页面加载：< 2s（静态资源CDN加速）。  
  - 单张图像预测：< 3s（GPU加速推理）。

#### **2. 安全需求**（联邦学习本身具备一定的安全性，需要时再拓展）
- 数据加密：客户端梯度传输使用AES-256加密。
- 隐私保护：支持差分隐私（DP）或同态加密（HE）算法。
- 访问控制：RBAC权限模型，医生仅可访问所属机构数据。

#### **3. 可靠性需求**（需启用数据库，以后拓展）
- 服务容错：客户端断线后自动重试，服务端模型版本回滚机制。
- 日志追踪：保留6个月操作日志，支持溯源审计。

#### **4. 可扩展性**（以后拓展）
- 模块化设计：可快速替换聚合算法（如切换FedAvg至FedBN）。
- 横向扩展：支持动态添加客户端节点，无需重启服务。

---

### **五、系统架构图**
```mermaid
graph TD
    A[前端-Vue.js] -->|HTTP| B(后端-Spring Boot)
    B -->|REST API| C[算法服务端-FastAPI]
    C -->|gRPC| D[客户端1-Python]
    C -->|gRPC| E[客户端2-Python]
    C -->|gRPC| F[客户端···-Python]
    C -->|gRPC| G[客户端n-Python]
    B -->|SDK| G[MinIO]
```

---

### **六、数据流说明**
1. **联邦训练流程**：
   - 管理员创建任务 → 服务端初始化模型 → 客户端下载模型 → 本地训练 → 梯度上传 → 服务端聚合 → 更新全局模型并传递给后端（循环至收敛）。
2. **数据呈现流程**
   - 后端轮询获取服务端数据→  → 前端获取后端数据 → 前端展示最终可视化页面。
3. **癌症识别流程**：（以后拓展）
   - 医生上传图像 → 后端调用全局模型 → 返回预测结果 → 前端渲染热力图。

---

### **七、验收标准**
1. **功能验收**：
   - 成功完成5家模拟机构的联邦训练任务，全局模型准确率 > 85%。
   - 支持1000张以上病理图像的并发预测，无服务崩溃。

2. **性能验收**：
   - 客户端梯度上传延迟 < 1s（局域网环境）。
   - 日志从生成到前端展示延迟 < 5s。

3. **安全验收**：
   - 通过OWASP ZAP扫描，无高危漏洞。
   - 客户端数据包捕获测试显示梯度为密文。

---

### **八、依赖与约束**
- **硬件依赖**：服务端需GPU（NVIDIA Tesla T4以上）加速聚合计算。（用云服务器）
- **法律约束**：病理数据需脱敏处理，符合《医疗数据隐私保护条例》。

---
